{% extends 'base.html' %}

{% load static %}
{% load review_tags %}

{% block page_title %}Home{% endblock page_title %}

{% block main_content %}
{% for game in games  %}
	<div class="container-fluid w-100 game-container-expanded p-0 mx-0 ">
		<div class="d-flex flex-row align-items-stretch">
			<!-- #region ==== THUMB BOX =============================================================== -->
			<div class="game-thumb-wrapper">
				{% if  game.thumb_img %}
					<img class="img-fluid game-thumb-large-img" src="{{ game.thumb_img.url }}" alt="{{ game.title }} - Cover image">
				{% else %}
					<img src="{% static "img/img_placeholder_244x300.jpg"%}" alt="Empty placeholder - Game cover image is missing">
				{% endif %}
				<div class="pegi-overlay">
					<a href="https://pegi.info/what-do-the-labels-mean" target="_blank">
						<img src="{{ game.pegi.pegi_img.url }}" alt="{{ game.pegi }} age label">
					</a>
				</div>
			</div>
			<!-- #endregion -->

			<!-- #region ==== INFO BOX ================================================================ -->
			<div class="flex-grow-1 game-info-box">
				
				<!-- #region ==== Row 1 - Title ======================================================= -->
				<div class="game-info-row-1 shadow-bottom-right game-title">
					<div class="invisible">
						<h2>{{ game.title }}</h2>
					</div>
					<div class="title-wrapper">
						<span class="game-title-initial-cap">{{ game.title|slice:"1" }}</span>{{game.title|slice:"1:"}}
					</div>
				</div>
				<!-- #endregion -->
				<!-- #region ==== Row 2 - Date, Platforms, Dev/Publ, Tags ============================= -->
				<div class="d-flex flex-row game-info-row-2 mt-2">
					<div class="d-flex flex-column flex-grow-1">
						<!-- #region ++++ Date ++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
						<div class="txt-medium">
							<strong>{{ game.release_date }}</strong>
						</div>
						<!-- #endregion -->
						<!-- #region ++++ Plattforms ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
						<div class="txt-small">
							<span>
								{% for platform in game.platforms.all %}
								{% if platform.show_icon %}
									{{ platform.icon | safe }}
								{% elif platform.show_img %}
									<img class="platform-icon-image" src="{{ platform.img.url }}" alt="">
								{% endif %}
									{{ platform.short_name}}
								{% endfor %}
							</span>
						</div>
						<!-- #endregion -->
						<!-- #region ++++ Dev / Publ ++++++++++++++++++++++++++++++++++++++++++++++++++ -->
						<div class="d-none d-md-block txt-small">
						<span>
							{% if game.developer %}
								{% if game.developer.web_url %}
									<a href="{{ game.developer.web_url }}" target="_blank">Dev: {{ game.developer.short_name }}</a>
								{% else %}
									Dev: {{ game.developer.short_name }}</a>
								{% endif %}
							{% endif %}
						</span>
							<span>
								{% if game.developer and game.publisher %}
									<br>
								{% endif %}
							</span>
						<span>
							{% if game.publisher %}
								{% if game.publisher.web_url %}
									<a href="{{ game.publisher.web_url }}" target="_blank">Publ: {{ game.publisher.short_name }}</a>
								{% else %}
									Publ: {{ game.publisher.short_name }}</a>
								{% endif %}
							{% endif %}
						</span>
						</div>
						<!-- #endregion -->
					
					</div>
					<!-- #region ++++++++ Tags ++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
					<div class="tags-container mr-2">
						<div class="text-right">
							{% for tag in game.genre_tags.all %}
							<span class="ml-1 shadow-faint-small tag tag-genre">
								{% if tag.show_name %}
									{{ tag.short_name }}
								{% endif %}
								{% if tag.show_icon %}
									{{ tag.icon | safe }}
								{% endif %}
							</span>
							{% endfor %}
						</div>
						<div class="ml-1 text-right">
							{% for tag in game.theme_tags.all %}
								<span class="ml-2 shadow-faint-small tag tag-theme">
									{% if tag.show_name %}
										{{ tag.short_name }}
									{% endif %}
									{% if tag.show_icon %}
										{{ tag.icon | safe }}
									{% endif %}
								</span>
								
							{% endfor %}
						</div>
						<div class="ml-1 text-right">
							{% for tag in game.misc_tags.all %}
								<span class="ml-2 shadow-faint-small tag tag-misc">
									{% if tag.show_name %}
										{{ tag.short_name }}
									{% endif %}
									{% if tag.show_icon %}
										{{ tag.icon | safe }}
									{% endif %}
								</span>
							{% endfor %}
						</div>
					</div>
					<!-- #endregion -->
				</div>
				<!-- #endregion -->
				<!-- #region ==== Row 3 - Score, Reviews ============================================== -->
				<div class="d-flex flex-row game-info-row-3">
					<!-- #region ++++++++ Score ++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->				
					{% for key in game_scores %}
						{% if key == game.id  %}
							<div class="score-wrapper">	
								<div class="score shadow-bottom-right">
									<span class="score-text score-text-digits">{{ key }}</span><br>
								</div>
							</div>
						{% endif %}
					{% endfor %}
					<!-- #endregion -->
					<!-- #region ++++++++ Reviews ++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
					<div id="game_{{ game.id }}">	
						<!-- #region - Compact view - -->	
						<div class="reviews-container rc-compact">
							<div class="d-flex flex-column mr-2 shadow-bottom-right reviews-quotes">
								{% for review in game.review_set.all  %}
									{% if forloop.counter <= 2 %}		
										<div class="reviews-text-box">
											<a href="{{ review.review_url }}" target="_blank">	
												<span class="review-quote-src">
													{{ review.review_site.site_short_name }} - 
													{{ review.score.normalize }} / {{ review.review_site.max_score }}
												</span>
												"{{ review.short_quote }}
											</a>
											<div class="reviews-end-dots">..."</div>
										</div>
									{% endif %}	
								{% endfor %}	
							</div>
							<!-- #region ++++++++ Button +++++++++++++++++++++++++++++++++++++++++++++++++++ -->
							<div class="expand-button-wrapper mr-2">
								<button class="expand-button shadow-bottom-right" data-id="game_{{ game.id }}" data-targetopen="rc-expanded" data-targetclose="rc-compact">
									More Reviews <i class="fas fa-caret-down icon-downarrow"></i>
								</button>
							</div>
							<!-- #endregion -->
						</div>
						<!-- #endregion -->	
						<!-- #region - Expanded view - -->	
						<div class="reviews-container rc-expanded" id="game_{{ game.id }}">
							<div class="d-flex flex-column mr-2 shadow-bottom-right reviews-quotes">
								{% for review in game.review_set.all  %}
									{% if forloop.counter %}		
										<div class="reviews-text-box">
											<a href="{{ review.review_url }}" target="_blank">	
												<span class="review-quote-src">
													{{ review.review_site.site_short_name }} - 
													{{ review.score.normalize }} / {{ review.review_site.max_score }}
												</span>
												"{{ review.short_quote }}
											</a>
											<div class="reviews-end-dots">..."</div>
										</div>
									{% endif %}	
								{% endfor %}	
							</div>
							<!-- #region ++++++++ Button +++++++++++++++++++++++++++++++++++++++++++++++++++ -->
							<div class="expand-button-wrapper mr-2">
								<button class="expand-button shadow-bottom-right" data-id="game_{{ game.id }}" data-targetopen="rc-compact" data-targetclose="rc-expanded">
									More Reviews <i class="fas fa-caret-down icon-downarrow"></i>
								</button>
							</div>
							<!-- #endregion -->
						</div>						
					</div>	
					<!-- #endregion -->
				</div>
				<!-- #endregion -->
				<!-- #region ==== Row 4 - Description ================================================= -->
					<div class="d-flex flex-column align-content-stretch game-info-row-4 descr-wrapper">
						<div class="descr-row-1">
							<span class="descr-source">
								<a href="{{ game.description_src_url }}" target="_blank">({{ game.description_src }})</a>
							</span>
						</div>
						<div class="flex-grow-1 descr-row-2">
							<span class="descr-quote-sign">"</span>
							<span class="descr-capital">{{ game.description|slice:"1" }}</span>
							<span class="descr-bodytext">{{ game.description|slice:"1:" }}</span>
							<div class="descr-bottom-cover"></div>
						</div>
					</div>
					
				<!-- #endregion -->
			</div>
			<!-- #endregion -->
		</div>
		<!-- #region ======== GAME FOOTER ============================================================= -->
		<div class="d-flex flex-row shadow-inside-up game-footer-box">
			<div class="description-end-dots">...<span class="descr-quote-sign-2">"</span></div>
			<div class="d-flex flex-grow-1 stores">

			
			</div>
			<div>
				<button class="details-button" data-id="gameid-1" data-target="reviews-expanded">
					<span class="read-more-txt">...read more</span><span class="details-txt"> Game Details <i class="fas fa-caret-right icon-rightarrow"></i></span>
				</button>
			</div>	
		</div>
		<!-- #endregion -->
	</div>

{% endfor %}
{% endblock %}